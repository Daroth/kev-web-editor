/*
         * Copyright 2010-2013 JetBrains s.r.o.
         *
         * Licensed under the Apache License, Version 2.0 (the "License");
         * you may not use this file except in compliance with the License.
         * You may obtain a copy of the License at
         *
         * http://www.apache.org/licenses/LICENSE-2.0
         *
         * Unless required by applicable law or agreed to in writing, software
         * distributed under the License is distributed on an "AS IS" BASIS,
         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
         * See the License for the specific language governing permissions and
         * limitations under the License.
         */

define(["kotlin/kotlin-lib"],function(e){return function(){function r(e){var n;if(typeof e=="string")return e;if(typeof e.hashCode==t)return n=e.hashCode(),typeof n=="string"?n:r(n);if(typeof e.toString==t)return e.toString();try{return String(e)}catch(i){return Object.prototype.toString.call(e)}}function i(e,t){return e.equals(t)}function s(e,n){return typeof n.equals==t?n.equals(e):e===n}function o(e){return function(t){if(t===null)throw new Error("null is not a valid "+e);if(typeof t=="undefined")throw new Error(e+" must not be undefined")}}function f(e,t,n,r){this[0]=e,this.entries=[],this.addEntry(t,n),r!==null&&(this.getEqualityFunction=function(){return r})}function p(e){return function(t){var n=this.entries.length,r,i=this.getEqualityFunction(t);while(n--){r=this.entries[n];if(i(t,r[0]))switch(e){case l:return!0;case c:return r;case h:return[n,r[1]]}}return!1}}function d(e){return function(t){var n=t.length;for(var r=0,i=this.entries.length;r<i;++r)t[n+r]=this.entries[r][e]}}function v(e,t){var n=e.length,r;while(n--){r=e[n];if(t===r[0])return n}return null}function m(e,t){var n=e[t];return n&&n instanceof f?n:null}var t="function",n=typeof Array.prototype.splice==t?function(e,t){e.splice(t,1)}:function(e,t){var n,r,i;if(t===e.length-1)e.length=t;else{n=e.slice(t+1),e.length=t;for(r=0,i=n.length;r<i;++r)e[t+r]=n[r]}},u=o("key"),a=o("value"),l=0,c=1,h=2;f.prototype={getEqualityFunction:function(e){return typeof e.equals==t?i:s},getEntryForKey:p(c),getEntryAndIndexForKey:p(h),removeEntryForKey:function(e){var t=this.getEntryAndIndexForKey(e);return t?(n(this.entries,t[0]),t[1]):null},addEntry:function(e,t){this.entries[this.entries.length]=[e,t]},keys:d(0),values:d(1),getEntries:function(e){var t=e.length;for(var n=0,r=this.entries.length;n<r;++n)e[t+n]=this.entries[n].slice(0)},containsKey:p(l),containsValue:function(e){var t=this.entries.length;while(t--)if(e===this.entries[t][1])return!0;return!1}};var g=function(i,s){var o=this,l=[],c={},h=typeof i==t?i:r,p=typeof s==t?s:null;this.put=function(e,t){u(e),a(t);var n=h(e),r,i,s=null;return r=m(c,n),r?(i=r.getEntryForKey(e),i?(s=i[1],i[1]=t):r.addEntry(e,t)):(r=new f(n,e,t,p),l[l.length]=r,c[n]=r),s},this.get=function(e){u(e);var t=h(e),n=m(c,t);if(n){var r=n.getEntryForKey(e);if(r)return r[1]}return null},this.containsKey=function(e){u(e);var t=h(e),n=m(c,t);return n?n.containsKey(e):!1},this.containsValue=function(e){a(e);var t=l.length;while(t--)if(l[t].containsValue(e))return!0;return!1},this.clear=function(){l.length=0,c={}},this.isEmpty=function(){return!l.length};var d=function(e){return function(){var t=[],n=l.length;while(n--)l[n][e](t);return t}};this._keys=d("keys"),this._values=d("values"),this._entries=d("getEntries"),this.values=function(){var t=this._values(),n=t.length,r=e.$new(e.ArrayList)();while(n--)r.add(t[n]);return r},this.remove=function(e){u(e);var t=h(e),r,i=null,s=m(c,t);return s&&(i=s.removeEntryForKey(e),i!==null&&(s.entries.length||(r=v(l,t),n(l,r),delete c[t]))),i},this.size=function(){var e=0,t=l.length;while(t--)e+=l[t].entries.length;return e},this.each=function(e){var t=o._entries(),n=t.length,r;while(n--)r=t[n],e(r[0],r[1])},this.putAll=function(e,n){var r=e._entries(),i,s,u,a,f=r.length,l=typeof n==t;while(f--)i=r[f],s=i[0],u=i[1],l&&(a=o.get(s))&&(u=n(s,a,u)),o.put(s,u)},this.clone=function(){var e=new g(i,s);return e.putAll(o),e},this.keySet=function(){var t=e.$new(e.ComplexHashSet)(),n=this._keys(),r=n.length;while(r--)t.add(n[r]);return t}};e.HashTable=g}(),e.Map=e.$createClass(),e.HashMap=e.$createClass(e.Map,{initialize:function(){e.HashTable.call(this)}}),e.ComplexHashMap=e.HashMap,function(){var t=e.$createClass(e.Iterator,{initialize:function(e,t){this.map=e,this.keys=t,this.size=t.length,this.index=0},next:function(){return this.map[this.keys[this.index++]]},hasNext:function(){return this.index<this.size}}),n=e.$createClass(e.Collection,{initialize:function(e){this.map=e},iterator:function(){return e.$new(t)(this.map.map,e.keys(this.map.map))},isEmpty:function(){return this.map.$size===0},contains:function(e){return this.map.containsValue(e)}});e.PrimitiveHashMap=e.$createClass(e.Map,{initialize:function(){this.$size=0,this.map={}},size:function(){return this.$size},isEmpty:function(){return this.$size===0},containsKey:function(e){return this.map[e]!==undefined},containsValue:function(e){var t=this.map;for(var n in t)if(t.hasOwnProperty(n)&&t[n]===e)return!0;return!1},get:function(e){return this.map[e]},put:function(e,t){var n=this.map[e];return this.map[e]=t===undefined?null:t,n===undefined&&this.$size++,n},remove:function(e){var t=this.map[e];return t!==undefined&&(delete this.map[e],this.$size--),t},clear:function(){this.$size=0,this.map={}},putAll:function(e){var t=e.map;for(var n in t)t.hasOwnProperty(n)&&(this.map[n]=t[n],this.$size++)},keySet:function(){var t=e.$new(e.PrimitiveHashSet)(),n=this.map;for(var r in n)n.hasOwnProperty(r)&&t.add(r);return t},values:function(){return e.$new(n)(this)},toJSON:function(){return this.map}})}(),e.Set=e.$createClass(e.Collection),e.PrimitiveHashSet=e.$createClass(e.AbstractCollection,{initialize:function(){this.$size=0,this.map={}},contains:function(e){return this.map[e]===!0},add:function(e){var t=this.map[e];return this.map[e]=!0,t===!0?!1:(this.$size++,!0)},remove:function(e){return this.map[e]===!0?(delete this.map[e],this.$size--,!0):!1},clear:function(){this.$size=0,this.map={}},toArray:function(){return e.keys(this.map)}}),function(){function t(n,r){var i=new e.HashTable(n,r);this.add=function(e){i.put(e,!0)},this.addAll=function(e){var t=e.length;while(t--)i.put(e[t],!0)},this.values=function(){return i._keys()},this.iterator=function(){return e.arrayIterator(this.values())},this.remove=function(e){return i.remove(e)?e:null},this.contains=function(e){return i.containsKey(e)},this.clear=function(){i.clear()},this.size=function(){return i.size()},this.isEmpty=function(){return i.isEmpty()},this.clone=function(){var e=new t(n,r);return e.addAll(i.keys()),e},this.equals=function(t){if(t===null||t===undefined)return!1;if(this.size()===t.size()){var n=this.iterator(),r=t.iterator();for(;;){var i=n.hasNext(),s=r.hasNext();if(i!=s)return!1;if(!s)return!0;var o=n.next(),u=r.next();if(!e.equals(o,u))return!1}}return!1},this.toString=function(){var e="[",t=this.iterator(),n=!0;while(t.hasNext())n?n=!1:e+=", ",e+=t.next();return e+="]",e},this.intersection=function(e){var s=new t(n,r),o=e.values(),u=o.length,a;while(u--)a=o[u],i.containsKey(a)&&s.add(a);return s},this.union=function(e){var t=this.clone(),n=e.values(),r=n.length,s;while(r--)s=n[r],i.containsKey(s)||t.add(s);return t},this.isSubsetOf=function(e){var t=i.keys(),n=t.length;while(n--)if(!e.contains(t[n]))return!1;return!0}}e.HashSet=e.$createClass(e.Set,{initialize:function(){t.call(this)}}),e.ComplexHashSet=e.HashSet}(),e});