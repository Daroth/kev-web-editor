define(["templates/dictionary"],function(e){function n(e){this._ctrl=e}function r(e){var t="";for(var n=0;n<e.length;n++)e[n].getAttribute().getFragmentDependant()||(t+=e[n].getUI().getHTML());return t}function i(e){var t=[],n={};for(var r=0;r<e.length;r++)if(e[r].getAttribute().getFragmentDependant()){var i=n[e[r].getTargetNode().getName()]||"";i+=e[r].getUI().getHTML(),n[e[r].getTargetNode().getName()]=i}for(var s in n)t.push({name:s,fragDepAttrsHTML:n[s]});return t}var t=".entity-dictionary";return n.prototype.getHTML=function(){var t=this._ctrl.getValues();return e({name:this._ctrl.getEntity().getName(),attrsHTML:r(t),nodes:i(t)})},n.prototype.onHTMLAppended=function(){var e=this;$("#prop-popup-save").off("click"+t),$("#prop-popup-save").on("click"+t,function(){var t=[],n=[],r=e._ctrl.getValues();for(var i=0;i<r.length;i++){var s=r[i].getAttribute().getName(),o=r[i].getAttribute().getFragmentDependant();if(o){var u=r[i].getTargetNode().getName();n[u]==undefined&&(n[u]=[],n.length+=1),n[u][s]=$("#instance-attr-"+u+"-"+s).val(),n[u].length+=1}else t[s]=$("#instance-attr-"+s).val(),t.length+=1}e._ctrl.p2cSaveDictionary(t,n)});for(var n=0;n<this._ctrl.getValues().length;n++)this._ctrl.getValues()[n].getUI().onHTMLAppended()},n});